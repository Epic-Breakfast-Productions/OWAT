import java.text.SimpleDateFormat

/*
 * This build file was initially auto generated by running the Gradle 'init' task
 * by 'Greg Stewart' at '3/21/17 9:02 PM' with Gradle 2.10
 *
 */

repositories {
	jcenter()
}

apply plugin: 'java'

version="1.4.2";

// Dependencies for the library
dependencies {
	//logging dependencies
	compile 'org.apache.logging.log4j:log4j-slf4j-impl:2.+'
	compile 'org.apache.logging.log4j:log4j-api:2.+'
	compile 'org.apache.logging.log4j:log4j-core:2.+'
	compile 'com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:2+'
	compile 'com.fasterxml.jackson.core:jackson-databind:2+'

	//for processing command line arguments
	compile 'args4j:args4j:2.33'
	compile 'args4j:args4j-site:2.33'

	//for actual code needs
	compile 'com.fasterxml.jackson.core:jackson-databind:2.9.+'

	//test dependencies
	testCompile 'junit:junit:4.12'
	testCompile 'com.google.guava:guava:23.6-jre'
	testCompile 'pl.pragmatists:JUnitParams:1.1.1'
}


String projectPropertiesFile = "project.properties";
String projectPropertiesDir = "$projectDir/src/test/resources/";
/**
 * Writes out the version configuration for the app.
 */
//noinspection GroovyAssignabilityCheck
task writeVersionConfig() {
	doLast {
		new File(projectPropertiesDir + projectPropertiesFile).text = """
################################################################
#                                                              #
# Main properties file. Contains values used in the lib.       #
#                                                              #
# AUTOGENERATED BY GRADLE AT BUILD TIME. DO NOT EDIT THIS FILE #
#                                                              #
################################################################

# the version of the library code
lib.version = $version
# the time of build
lib.buildtime: ${new SimpleDateFormat("dd-MM-yyyy HH:mm:ss").format(new Date())}
"""
		sleep((int)(0.25 * 1000));
	}
}

task deleteVersionConfig(type: Delete) {
	delete fileTree(projectPropertiesDir) {
		include "**/$projectPropertiesFile"
	}
}

compileJava {
	dependsOn 'writeVersionConfig';
}

clean {
	dependsOn 'deleteVersionConfig';
}
